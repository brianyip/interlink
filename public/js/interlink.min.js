!function(){"use strict";function t(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const e=function(){const t=document.querySelector("script[data-user-id]");return t&&t.src?new URL(t.src).origin:window.location.origin}()+"/api/public/links",n="interlink_links_cache",i=3e5,o={get:function(t){try{const e=localStorage.getItem(t);if(!e)return null;const n=JSON.parse(e);return Date.now()>n.expiry?(localStorage.removeItem(t),null):n.value}catch(t){return null}},set:function(t,e,n){try{const i={value:e,expiry:Date.now()+n};localStorage.setItem(t,JSON.stringify(i))}catch(t){}}};function r(t,e){this.userId=t,this.options=Object.assign({replaceAll:!0},e||{}),this.links=null,this.isLoading=!1}r.prototype={fetchLinks:function(){const t=this,r=n+"_"+this.userId,s=o.get(r);return s?(this.links=s,Promise.resolve(s)):this.isLoading?this.loadingPromise:(this.isLoading=!0,this.loadingPromise=fetch(e+"/"+this.userId).then(function(t){if(!t.ok)throw new Error("Failed to fetch links: "+t.status);return t.json()}).then(function(e){return t.links=e,t.isLoading=!1,o.set(r,e,i),e}).catch(function(e){return t.isLoading=!1,console.warn("Interlink: Failed to fetch links",e),[]}),this.loadingPromise)},findLink:function(t){return this.links?this.links.find(function(e){return e.key===t}):null},generateReplacement:function(t,e){const n=e||t.displayName;return t.url&&t.url.trim()?'<a href="'+this.escapeHtml(t.url)+'" target="_blank" rel="nofollow">'+this.escapeHtml(n)+"</a>":this.escapeHtml(n)},escapeHtml:function(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML},replacePlaceholders:function(e){const n=this;if(!this.links||0===this.links.length)return e;const i=this.links.slice().sort(function(t,e){return e.key.length-t.key.length});let o=e;return i.forEach(function(e){if(e.key&&e.key.trim()){const i=t(e.key),r=new RegExp(i,"g"),s=n.generateReplacement(e,null);o=o.replace(r,s)}}),o},processNode:function(t){const e=this;if(t.nodeType===Node.TEXT_NODE){const e=t.textContent,n=this.replacePlaceholders(e);if(e!==n){const e=document.createElement("div");e.innerHTML=n;const i=document.createDocumentFragment();for(;e.firstChild;)i.appendChild(e.firstChild);t.parentNode.replaceChild(i,t)}}else if(t.nodeType===Node.ELEMENT_NODE&&"SCRIPT"!==t.tagName&&"STYLE"!==t.tagName){Array.from(t.childNodes).forEach(function(t){e.processNode(t)})}},processDocument:function(){this.links?this.processNode(document.body):console.warn("Interlink: No links loaded")},init:function(){const t=this;this.fetchLinks().then(function(){t.processDocument()})}},window.Interlink=r,function(){const t=document.querySelector("script[data-user-id]");if(t){const e=t.getAttribute("data-user-id"),n="false"!==t.getAttribute("data-replace-all");if(e){const t=new r(e,{replaceAll:n});"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t.init()}):t.init()}}}()}();