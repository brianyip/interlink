(function(){'use strict';const t={apiBaseUrl:'https://your-domain.vercel.app/api/public/cards',cacheKey:'interlink_cards_cache',cacheExpiry:3e5,placeholderPattern:/\{\{Card:([^}|]+)(\|custom=([^}]+))?\}\}/g},e={get:function(t){try{const e=localStorage.getItem(t);if(!e)return null;const n=JSON.parse(e);return Date.now()>n.expiry?(localStorage.removeItem(t),null):n.value}catch(t){return null}},set:function(t,e,n){try{const r={value:e,expiry:Date.now()+n};localStorage.setItem(t,JSON.stringify(r))}catch(t){}}};function n(t,e){this.userId=t,this.options=Object.assign({replaceAll:!0,customFallback:function(t,e){return e||'{{Card:'+t+'}}'}},e||{}),this.cards=null,this.isLoading=!1}n.prototype={fetchCards:function(){const n=this,r=t.cacheKey+'_'+this.userId,a=e.get(r);return a?(this.cards=a,Promise.resolve(a)):this.isLoading?this.loadingPromise:(this.isLoading=!0,this.loadingPromise=fetch(t.apiBaseUrl+'/'+this.userId).then(function(t){if(!t.ok)throw new Error('Failed to fetch cards: '+t.status);return t.json()}).then(function(a){return n.cards=a,n.isLoading=!1,e.set(r,a,t.cacheExpiry),a}).catch(function(t){return n.isLoading=!1,console.warn('Interlink: Failed to fetch cards',t),[]}),this.loadingPromise)},findCard:function(t){return this.cards?this.cards.find(function(e){return e.key===t}):null},generateReplacement:function(t,e){const n=e||t.display_name;return'<a href="'+this.escapeHtml(t.terms_url)+'" target="_blank" rel="nofollow">'+this.escapeHtml(n)+' (terms)</a>'},escapeHtml:function(t){const e=document.createElement('div');return e.textContent=t,e.innerHTML},replacePlaceholders:function(e){const n=this;return e.replace(t.placeholderPattern,function(t,e,r,a){const c=n.findCard(e);return c?n.generateReplacement(c,a):n.options.customFallback(e,a)})},processNode:function(t){const e=this;if(t.nodeType===Node.TEXT_NODE){const e=t.textContent,n=this.replacePlaceholders(e);if(e!==n){const e=document.createElement('div');e.innerHTML=n;const r=document.createDocumentFragment();for(;e.firstChild;)r.appendChild(e.firstChild);t.parentNode.replaceChild(r,t)}}else if(t.nodeType===Node.ELEMENT_NODE&&'SCRIPT'!==t.tagName&&'STYLE'!==t.tagName){Array.from(t.childNodes).forEach(function(t){e.processNode(t)})}},processDocument:function(){this.cards?this.processNode(document.body):console.warn('Interlink: No cards loaded')},init:function(){const t=this;this.fetchCards().then(function(){t.processDocument()})}},window.Interlink=n,function(){const t=document.querySelector('script[data-user-id]');if(t){const e=t.getAttribute('data-user-id'),r='false'!==t.getAttribute('data-replace-all');if(e){const t=new n(e,{replaceAll:r});'loading'===document.readyState?document.addEventListener('DOMContentLoaded',function(){t.init()}):t.init()}}}()})();